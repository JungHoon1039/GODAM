<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

{% extends 'base.html' %}
{% block content %}
<img src ="{{i.Catimage.url}}" width="100px" height="100px">
이름:{{i.Catname}}
나이:{{i.Catage}}
중성화:{{i.Neutering}}
지역:{{i.Region}}
작성자:{{i.User.Username}}
<div>
    <input type="button" id="like" name="{{i.Catid}}" value="Like">
    <p id="count-{{i.Catid}}">
        좋아요{{i.Like_user.all.count}}개</p>
</div>

<!-- 작성자가 본인 컨텐츠를 확인할경우 버튼 보이게 하기(프론트앤드 유효성)-->
{%if i.User.Userid == owner.Userid%}
<button type="button" onclick="location.href ='{%url 'catedit' i.Catid%}'">수정</button>
<button type="button" onclick="showConfirm()">삭제</button>
{%endif%}
<div class="container">
    <div class="row">
        <div class="col-12">
            <form method="post">
                {% csrf_token %}
                {{form.as_p}}
                <button type="submit">작성</button><br>
            </form>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-12">
        {% for comment in cat.board_set.all %}
            작성자 : {{ comment.Usernum.Nickname }} <br>
            댓글 : {{ comment.Content }} <br>
            {% if comment.Usernum.Userid == owner.Userid%}
                <button type="button"><a href="{% url 'bd' comment.Catnum.Catid comment.Boardid %}">댓글삭제</a></button>
            {% endif %}
            <br>
        {% endfor %}
        </div>
    </div>
</div>
<script>
    $("#like").click(function () { // .like 버튼을 클릭 감지
        var Catid = $(this).attr('name')
        $.ajax({ // ajax로 서버와 통신
            type: "POST", // 데이터를 전송하는 방법
            url: 'catlike', // 통신할 url을 지정
            data: { 'Catid': Catid, 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // 서버로 데이터 전송시 옵션, pk 넘겨야 어떤캣 인지 알 수 있음
            dataType: "json",
            success: function (response) { // 성공
                $("#like").html(value="unlike");
                $("#count-" + Catid).html("좋아요" + response.likes_count + "개"); // 좋아요 개수 변경
            },
        });
    })
        function showConfirm(){
        if(confirm("정말로 고양이를 삭제하겠습니까?"))
    {
        alert("고양이를 삭제했습니다");
        window.location.href = '{%url "catdelete" i.Catid%}';
    }
    }
</script>

{% endblock content %}